@model Order

@{
    ViewData["Title"] = "Order Details";
}

<div class="container mt-3">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="fw-semibold mb-0">
            <i class="bi bi-receipt-cutoff me-2 text-primary"></i> Order details
        </h3>
    </div>

    <div class="card border-0 shadow-sm rounded-3 p-4 mb-4">
        <dl class="row mb-0">
            <dt class="col-md-3 col-sm-4 text-muted fw-semibold">Customer</dt>
            <dd class="col-md-9 col-sm-8">@Model.FullName</dd>

            <dt class="col-md-3 col-sm-4 text-muted fw-semibold">Status</dt>
            <dd class="col-md-9 col-sm-8">
                <select id="status-select" class="border-0 shadow-sm rounded-2">
                    <option value="Pending">Pending</option>
                    <option value="Paid">Paid</option>
                    <option value="Cancelled">Cancelled</option>
                </select>
            </dd>

            <dt class="col-md-3 col-sm-4 text-muted fw-semibold">Phone</dt>
            <dd class="col-md-9 col-sm-8">@Model.PhoneNumber</dd>

            <dt class="col-md-3 col-sm-4 text-muted fw-semibold">Address</dt>
            <dd class="col-md-9 col-sm-8">@Model.Address, @Model.City, @Model.Country</dd>

            <dt class="col-md-3 col-sm-4 text-muted fw-semibold">Note</dt>
            <dd class="col-md-9 col-sm-8">@Model.Note</dd>

            <dt class="col-md-3 col-sm-4 text-muted fw-semibold">Total Amount</dt>
            <dd class="col-md-9 col-sm-8 text-success fw-bold fs-5">
                $@($"{Model.TotalAmount:F2}")
            </dd>
        </dl>
    </div>

    <div class="card rounded-3 overflow-hidden shadow-sm mb-3">
        <table class="table table-borderless m-0">
            <thead class="table-light">
                <tr>
                    <th>Product</th>
                    <th>Image</th>
                    <th>Quantity</th>
                    <th>Price</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var detail in Model.OrderDetails)
                {
                    <tr>
                        <td>@detail.Product.ProductName</td>
                        <td>
                            <img src="/images/products/@detail.Product.ImageUrl"
                                 alt="@detail.Product.ProductName"
                                 width="50" class="img-thumbnail" />
                        </td>
                        <td>@detail.Quantity</td>
                        <td>$@($"{detail.Product.Price:F2}")</td>
                        <td>$@($"{detail.Quantity * detail.Product.Price:F2}")</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
    <div class="text-start">
        <a href="/dashboard/order" class="btn btn-secondary">Cancel</a>
        <button id="btn-save" class="btn btn-primary">Save</button>
    </div>

</div>


@section Scripts {
    <script>
        $('option[value=@Model.Status]').prop('selected', true);

        $('#btn-save').click(function() {
            var selectedStatus = $('#status-select').val();

            url = '/Dashboard/Order/UpdateStatus/' + @Model.OrderId + '?status=' + selectedStatus;
        
            $.post(url, function(response){
                alert(response.message);
                if(response.success){
                     $(`option[value='${selectedStatus}']`).prop('selected', true);

                }
            });
        });

    </script>
}
